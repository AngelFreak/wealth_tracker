{{define "content"}}
<div class="space-y-6">
    <!-- Page Header -->
    <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
            <a href="/settings" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-dark-hover transition-all">
                <i data-lucide="arrow-left" class="w-5 h-5 text-gray-500 dark:text-gray-400"></i>
            </a>
            <div>
                <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">
                    Broker Connections
                </h1>
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Connect your brokerage accounts for automatic updates</p>
            </div>
        </div>
        <a href="/settings/connections/new"
           class="px-4 py-2.5 text-sm font-medium rounded-xl gradient-indigo text-white shadow-lg shadow-indigo-500/25 hover:shadow-indigo-500/40 transition-all flex items-center gap-2">
            <i data-lucide="plus" class="w-4 h-4"></i>
            Add Connection
        </a>
    </div>

    {{if .Error}}
    <div class="bg-red-500/10 border border-red-500/20 rounded-lg p-4">
        <div class="flex items-center gap-2">
            <i data-lucide="alert-circle" class="w-5 h-5 text-red-500"></i>
            <p class="text-sm text-red-400">{{.Error}}</p>
        </div>
    </div>
    {{end}}

    {{if .Success}}
    <div class="bg-emerald-500/10 border border-emerald-500/20 rounded-lg p-4">
        <div class="flex items-center gap-2">
            <i data-lucide="check-circle" class="w-5 h-5 text-emerald-500"></i>
            <p class="text-sm text-emerald-400">{{.Success}}</p>
        </div>
    </div>
    {{end}}

    <!-- Connections List -->
    {{if .Connections}}
    <div class="space-y-4">
        {{range .Connections}}
        <div class="rounded-2xl bg-white dark:bg-dark-surface border border-gray-200 dark:border-dark-border overflow-hidden">
            <div class="p-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-xl bg-blue-500/10 flex items-center justify-center">
                            <i data-lucide="briefcase" class="w-6 h-6 text-blue-500"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white capitalize">{{.BrokerType}}</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400">{{.Username}} ({{.Country | upper}})</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        {{if eq .LastSyncStatus "success"}}
                        <span class="px-3 py-1.5 rounded-full bg-emerald-500/10 text-xs text-emerald-500 border border-emerald-500/30 flex items-center gap-1">
                            <i data-lucide="check" class="w-3 h-3"></i>
                            Connected
                        </span>
                        {{else if eq .LastSyncStatus "error"}}
                        <span class="px-3 py-1.5 rounded-full bg-red-500/10 text-xs text-red-500 border border-red-500/30 flex items-center gap-1">
                            <i data-lucide="alert-circle" class="w-3 h-3"></i>
                            Error
                        </span>
                        {{else if eq .LastSyncStatus "auth_failed"}}
                        <span class="px-3 py-1.5 rounded-full bg-amber-500/10 text-xs text-amber-500 border border-amber-500/30 flex items-center gap-1">
                            <i data-lucide="key" class="w-3 h-3"></i>
                            Auth Failed
                        </span>
                        {{else}}
                        <span class="px-3 py-1.5 rounded-full bg-gray-500/10 text-xs text-gray-500 border border-gray-500/30 flex items-center gap-1">
                            <i data-lucide="clock" class="w-3 h-3"></i>
                            Not Synced
                        </span>
                        {{end}}

                        <a href="/settings/connections/{{.ID}}?action=sync"
                           class="px-3 py-1.5 rounded-lg bg-gray-100 dark:bg-dark-hover text-xs text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-dark-border transition-all flex items-center gap-1">
                            <i data-lucide="refresh-cw" class="w-3 h-3"></i>
                            Sync
                        </a>

                        <a href="/settings/connections/{{.ID}}"
                           class="px-3 py-1.5 rounded-lg bg-indigo-500/10 text-xs text-indigo-500 hover:bg-indigo-500/20 transition-all flex items-center gap-1">
                            <i data-lucide="settings" class="w-3 h-3"></i>
                            Manage
                        </a>
                    </div>
                </div>

                {{if .LastSyncAt}}
                <div class="mt-4 pt-4 border-t border-gray-200 dark:border-dark-border">
                    <p class="text-xs text-gray-500 dark:text-gray-400">
                        Last synced: {{.LastSyncAt.Format "Jan 02, 2006 15:04"}}
                    </p>
                </div>
                {{end}}
            </div>
        </div>
        {{end}}
    </div>
    {{else}}
    <!-- Empty State -->
    <div class="rounded-2xl bg-white dark:bg-dark-surface border border-gray-200 dark:border-dark-border p-12 text-center">
        <div class="w-16 h-16 rounded-2xl bg-gray-100 dark:bg-dark-hover mx-auto flex items-center justify-center mb-4">
            <i data-lucide="link" class="w-8 h-8 text-gray-400"></i>
        </div>
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">No connections yet</h3>
        <p class="text-sm text-gray-500 dark:text-gray-400 mb-6 max-w-md mx-auto">
            Connect your brokerage accounts to automatically sync your positions and update your portfolio.
        </p>
        <a href="/settings/connections/new"
           class="inline-flex items-center gap-2 px-6 py-2.5 text-sm font-medium rounded-xl gradient-indigo text-white shadow-lg shadow-indigo-500/25 hover:shadow-indigo-500/40 transition-all">
            <i data-lucide="plus" class="w-4 h-4"></i>
            Add Your First Connection
        </a>
    </div>
    {{end}}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
});
</script>
{{end}}
